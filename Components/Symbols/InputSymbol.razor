@using TestBlazor.Components.Symbols
@using TestBlazor.Components.Symbols.Generics

<SymbolWrapper IsSelected="IsSelected" IsEnabled="IsEnabled" HasCommLoss="HasCommLoss" HasCrossFilter="HasCrossFilter"
               AlarmState="AlarmState" AlarmBlink="AlarmBlink"
               Width="Width" Height="Height" Rotation="Rotation" MirrorX="MirrorX" MirrorY="MirrorY"
               OverlayContent="OverlayContent" OnClick="OnClick" OnSettingsClick="OnSettingsClick">
    <div class="input-symbol-container">
        <label>@Label</label>
        <input type="number" class="form-control" value="@Value" @oninput="OnValueChanged" @onclick:stopPropagation />
        <span class="unit">@Unit</span>
    </div>
</SymbolWrapper>

<style>
    .input-symbol-container {
        width: 100%;
        height: 100%;
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 4px;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        padding: 5px;
    }

    .input-symbol-container label {
        font-size: 0.8em;
        margin-bottom: 2px;
        font-weight: bold;
    }

    .input-symbol-container input {
        width: 100%;
        text-align: center;
        padding: 2px;
    }

    .unit {
        font-size: 0.8em;
        color: #6c757d;
    }
</style>

@code {
    [Parameter] public double Value { get; set; }
    [Parameter] public string Label { get; set; } = "Value";
    [Parameter] public string Unit { get; set; } = "";
    [Parameter] public EventCallback<double> ValueChanged { get; set; }

    // Wrapped Params
    [Parameter] public bool IsSelected { get; set; }
    [Parameter] public bool IsEnabled { get; set; } = true;
    [Parameter] public bool HasCommLoss { get; set; }
    [Parameter] public bool HasCrossFilter { get; set; }
    [Parameter] public int AlarmState { get; set; }
    [Parameter] public bool AlarmBlink { get; set; }
    
    [Parameter] public int Width { get; set; } = 100;
    [Parameter] public int Height { get; set; } = 80;
    [Parameter] public int Rotation { get; set; } = 0;
    [Parameter] public bool MirrorX { get; set; }
    [Parameter] public bool MirrorY { get; set; }

    [Parameter] public EventCallback<MouseEventArgs> OnClick { get; set; }
    [Parameter] public EventCallback OnSettingsClick { get; set; }
    [Parameter] public RenderFragment? OverlayContent { get; set; }

    private async Task OnValueChanged(ChangeEventArgs e)
    {
        if (double.TryParse(e.Value?.ToString(), out double val))
        {
            Value = val;
            await ValueChanged.InvokeAsync(val);
        }
    }
}
